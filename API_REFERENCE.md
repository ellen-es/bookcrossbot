# üõ† –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ—É–Ω–∫—Ü–∏–π (API Reference) ‚Äî BookCrossing Bot

–í –¥–∞–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –æ–ø–∏—Å–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ –º–æ–¥—É–ª—è–º. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ —è–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ (`async`).

---

## üíæ –ú–æ–¥—É–ª—å `models.py` (–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
*   `add_user(user_id, username, full_name, status='pending')`: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.
*   `get_user(user_id)`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ Telegram ID (–∏–ª–∏ `None`).
*   `update_user_profile(user_id, real_name, district, street)`: –û–±–Ω–æ–≤–ª—è–µ—Ç –∞–Ω–∫–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
*   `update_user_status(user_id, status)`: –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞ (`approved`, `blocked`, `pending`).
*   `set_admin_status(user_id, is_admin)`: –ù–∞–∑–Ω–∞—á–∞–µ—Ç –∏–ª–∏ —Å–Ω–∏–º–∞–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
*   `get_all_users()`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏
*   `add_book(owner_id, title, author, genre, tags, age_rating, description, photo_id)`: –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∫–Ω–∏–≥—É –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É.
*   `get_book(book_id)`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ.
*   `get_all_books()`: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥ –≤ —Å–∏—Å—Ç–µ–º–µ.
*   `search_books(query)`: –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ —Ç–µ–≥–∞–º (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π).
*   `delete_book(book_id, owner_id=None)`: –£–¥–∞–ª—è–µ—Ç –∫–Ω–∏–≥—É. –ï—Å–ª–∏ `owner_id` –Ω–µ —É–∫–∞–∑–∞–Ω, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∞–¥–º–∏–Ω-—É–¥–∞–ª–µ–Ω–∏–µ.
*   `update_book_info(...)`: –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏.

### –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
*   `create_booking(book_id, renter_id)`: –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥–∏.
*   `confirm_transfer(book_id, from_id, to_id)`: –§–∏–∫—Å–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –∫–Ω–∏–≥–∏ –Ω–æ–≤–æ–º—É —á–∏—Ç–∞—Ç–µ–ª—é –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é.
*   `return_book(book_id, user_id)`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–∏–≥—É –≤–ª–∞–¥–µ–ª—å—Ü—É.
*   `get_book_history(book_id)`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—é –≤—Å–µ—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –¥–∞–Ω–Ω–æ–π –∫–Ω–∏–≥–∏.

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –õ–æ–≥–∏
*   `get_stats()`: –°–æ–±–∏—Ä–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –∫–æ–ª-–≤–æ —é–∑–µ—Ä–æ–≤, –∫–Ω–∏–≥, —Ç–æ–ø—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–∑–¥–∞–Ω–∏–π –∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π.
*   `log_admin_action(admin_id, action_type, details)`: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `admin_logs`.
*   `get_admin_logs()`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π –∏–∑ –∂—É—Ä–Ω–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏–π.

---

## ü§ñ –ú–æ–¥—É–ª—å `main.py` (–°–ª—É–∂–µ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
*   `fetch_book_by_isbn(isbn)`: 
    *   *–í—Ö–æ–¥*: —Å—Ç—Ä–æ–∫–∞ —Å ISBN. 
    *   *–î–µ–π—Å—Ç–≤–∏–µ*: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Google Books –∏ Open Library. 
    *   *–í—ã—Ö–æ–¥*: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –∞–≤—Ç–æ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ) –∏–ª–∏ `None`.

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Keyboard Builders)
*   `main_menu()`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (ReplyKeyboardMarkup).
*   `get_genres_keyboard()`: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –∂–∞–Ω—Ä–æ–≤.
*   `get_age_ratings_keyboard()`: –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤.

---

## üõ° –§–∏–ª—å—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–∞
*   `is_approved(user_id)`: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ–¥–æ–±—Ä–µ–Ω–∞ –ª–∏ –∑–∞—è–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞.
