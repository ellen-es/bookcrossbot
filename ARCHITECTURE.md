# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî BookCrossing Bot

–í –¥–∞–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –æ–ø–∏—Å–∞–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±–æ—Ç–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

## üß± –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ **aiogram 3.x** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **SQLite** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

*   `main.py`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –∏ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (handlers) —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫.
*   `models.py`: –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏. –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –∏ –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.
*   `config.py`: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`.
*   `books_bot.db`: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite.

---

## üíæ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞ `users` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö –∫–ª—É–±–∞ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö –¥–æ—Å—Ç—É–ø–∞.
*   `user_id`: Telegram ID (Primary Key).
*   `username`: –ù–∏–∫–Ω–µ–π–º –≤ Telegram.
*   `real_name`: –ò–º—è, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
*   `district`: –†–∞–π–æ–Ω –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è.
*   `status`: –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ (`pending`, `approved`, `blocked`).
*   `is_admin`: –§–ª–∞–≥ (1 ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, 0 ‚Äî –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).

### 2. –¢–∞–±–ª–∏—Ü–∞ `books` (–ö–Ω–∏–≥–∏)
*   `owner_id`: –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (user_id).
*   `current_holder_id`: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ —á–∏—Ç–∞—Ç–µ–ª—è (NULL, –µ—Å–ª–∏ –∫–Ω–∏–≥–∞ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞).
*   `status`: `available` (–¥–æ—Å—Ç—É–ø–Ω–∞) –∏–ª–∏ `unavailable` (—Å–∫—Ä—ã—Ç–∞ –∏–ª–∏ –Ω–∞ —Ä—É–∫–∞—Ö).
*   `return_requested`: –§–ª–∞–≥ (1 ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –ø–æ–ø—Ä–æ—Å–∏–ª –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É).

### 3. –¢–∞–±–ª–∏—Ü–∞ `movements` (–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π)
–§–∏–∫—Å–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–Ω–∏–≥–∏.
*   `event_type`: —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (`transfer` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ —á–∏—Ç–∞—Ç–µ–ª—é, `return` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É).

### 4. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
*   `waitlist`: –û—á–µ—Ä–µ–¥—å –Ω–∞ –∫–Ω–∏–≥–∏.
*   `bookings`: –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
*   `reviews`: –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
*   `admin_logs`: –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤.

---

## ü§ñ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (FSM)

–ë–æ—Ç –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Finite State Machine** (–∫–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã) –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (`Registration`)
1.  `waiting_for_name`: –°–±–æ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏.
2.  `waiting_for_district`: –°–±–æ—Ä —Ä–∞–π–æ–Ω–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã.

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ (`AddBook`)
1.  `waiting_for_method`: –í—ã–±–æ—Ä (ISBN –∏–ª–∏ –≤—Ä—É—á–Ω—É—é).
2.  `waiting_for_isbn`: –ü–æ–∏—Å–∫ –≤–æ –≤–Ω–µ—à–Ω–∏—Ö API.
3.  `waiting_for_title` ... `waiting_for_photo`: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –∫–Ω–∏–≥–µ.

---

## üîå –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞—Å–∫–∞–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –ø–æ ISBN –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `fetch_book_by_isbn`:
1.  **Google Books API**: –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–ª–æ–∂–µ–∫ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.
2.  **Open Library API**: –†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –∫–≤–æ—Ç Google –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–Ω–∏–≥–∏ –≤ –∏—Ö –±–∞–∑–µ.

---

## üîê –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
*   **Access Middleware (–ª–æ–≥–∏–∫–∞)**: –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `is_approved`. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ `approved`, –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
*   **–ê–¥–º–∏–Ω–∫–∞**: –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–µ `/admin` –∏ –∫–Ω–æ–ø–∫–∞–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Ñ–ª–∞–≥–æ–º `is_admin = 1`.

---

## üìà –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SQL-–∞–≥—Ä–µ–≥–∞—Ü–∏—é:
*   `total_transfers`: –ü–æ–¥—Å—á–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π `transfer` –≤ –∏—Å—Ç–æ—Ä–∏–∏.
*   `top_readers`: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –ø–æ `to_user_id` —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É.
